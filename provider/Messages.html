<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#8b5cf6'
                    },
                    borderRadius: {
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                        'button': '8px'
                    }
                }
            }
        }
    </script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        body {
            /* font-family: 'Inter', sans-serif; */
            background-color: #f8fafc;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .rounded-button {
            border-radius: 9999px;
        }

        .conversation-list-pane {
            width: 320px;
            flex-shrink: 0;
        }

        .message-detail-pane {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .message-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            /* max-height: calc(100vh - 400px); */
        }

        .message-bubble {
            max-width: 75%;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 1rem;
            word-wrap: break-word;
        }

        .message-bubble{
            font-size: small;
        }

        .message-bubble.sender {
            background-color: #4f46e5;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }

        .message-bubble.recipient {
            background-color: #e5e7eb;
            color: #374151;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }

        .attachment-preview-item {
            display: inline-flex;
            align-items: center;
            background-color: #f3f4f6;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: scale(0.95);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .conversation-item.active {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: #f3f4f6;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            align-self: flex-start;
            max-width: 75%;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .conversation-list-pane {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
            }

            .message-detail-pane {
                display: none;
            }

            .message-detail-pane.active {
                display: flex;
            }

            .conversation-list-pane.hidden {
                display: none;
            }
        }

        /* Add custom font faces */
        @font-face {
            font-family: 'Poppins';
            src: url('https://s3-media0.fl.yelpcdn.com/assets/public/poppins-bold.yji-9690ce6275ddc5645cfa.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: 'Poppins';
            src: url('https://s3-media0.fl.yelpcdn.com/assets/public/poppins-medium.yji-dc16a3592fdb61b620cc.woff2') format('woff2');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'Open Sans';
            src: url('https://s3-media0.fl.yelpcdn.com/assets/public/open-sans-regular.yji-aff9b80e384301f2ae0c.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Open Sans';
            src: url('https://s3-media0.fl.yelpcdn.com/assets/public/open-sans-semibold.yji-d3abae27d3eac73b40a5.woff2') format('woff2');
            font-weight: 600;
            font-style: normal;
        }

        @font-face {
            font-family: 'Open Sans';
            src: url('https://s3-media0.fl.yelpcdn.com/assets/public/open-sans-bold.yji-1145ff0b749fff2d31bb.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        /* Example usage */
        .poppins-bold {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }

        .poppins-medium {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .open-sans {
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
        }

        .open-sans-semibold {
            font-family: 'Open Sans';
            font-weight: 600;
        }

        .open-sans-bold {
            font-family: 'Open Sans';
            font-weight: 700;
        }

        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        body {
            /*font-family: 'Inter', sans-serif;*/
            overflow: hidden;
        }

        /* Use Poppins Bold for all headings */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        label,
        aside,
        .ctaz {
            font-family: 'Poppins';
            /*font-weight: 700;*/
        }

        /* Use Open Sans Regular for body */
        body {
            font-family: 'Open Sans';
            /*font-weight: 400;*/
        }

        .sidebar-link.active {
            background-color: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
            border-left: 3px solid #4f46e5;
        }

        .sidebar-link:hover:not(.active) {
            background-color: rgba(79, 70, 229, 0.05);
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            color: #4f46e5;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
    </style>
</head>

<body>
    <div class="flex h-screen">
        <!-- <aside class="w-64 bg-white shadow-md p-4 flex flex-col">
            <div class="text-2xl font-bold text-blue-600 mb-8">Platform</div>
            <nav class="space-y-2">
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-dashboard-line"></i>
                    </div>
                    Dashboard
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-ticket-line"></i>
                    </div>
                    My Listings
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-calendar-check-line"></i>
                    </div>
                    Bookings
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-questionnaire-line"></i>
                    </div>
                    Requests
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg bg-blue-100 text-blue-700 font-semibold">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-message-3-line"></i>
                    </div>
                    Messages
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-star-line"></i>
                    </div>
                    Reviews
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-wallet-line"></i>
                    </div>
                    Payouts
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-bar-chart-line"></i>
                    </div>
                    Analytics
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-settings-3-line"></i>
                    </div>
                    Profile Settings
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                    <div class="w-5 h-5 flex items-center justify-center mr-3">
                        <i class="ri-question-line"></i>
                    </div>
                    Support
                </a>
            </nav>
        </aside> -->

        <aside id="sidebar"
            class="w-64 bg-white shadow-md h-full flex flex-col transition-all duration-300 ease-in-out">
            <div class="p-6 flex items-center border-b">
                <span class="text-2xl font-['Pacifico'] text-primary">logo</span>
            </div>

            <nav class="flex-1 overflow-y-auto py-4">
                <ul class="space-y-1 px-3">

                    <!-- Home -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Home-Dashboard.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-button text-gray-700 ">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-dashboard-line"></i>
                            </div>
                            Home
                        </a>
                    </li>

                    <!-- My Listings -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\My-Listings.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-ticket-line"></i>
                            </div>
                            My Listings
                        </a>
                    </li>

                    <!-- Bookings -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Bookings.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-calendar-check-line"></i>
                            </div>
                            Bookings
                        </a>
                    </li>

                    <!-- Requests -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Requests.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-questionnaire-line"></i>
                            </div>
                            Requests
                        </a>
                    </li>

                    <!-- Messages -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Messages.html"
                            class="active sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-message-3-line"></i>
                            </div>
                            Messages
                        </a>
                    </li>

                    <!-- Reviews -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Reviews.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-star-line"></i>
                            </div>
                            Reviews
                        </a>
                    </li>


                    <!-- payouts -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Payouts.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-wallet-line"></i>
                            </div>
                            Payouts
                        </a>
                    </li>

                    <!-- Analytics -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Analytics.html"
                            class="sidebar-link  flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-bar-chart-line"></i>
                            </div>
                            Analytics
                        </a>
                    </li>

                    <!-- Profile Settings -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Profile-Settings.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-settings-3-line"></i>
                            </div>
                            Profile Settings
                        </a>
                    </li>

                    <!-- Support -->
                    <li>
                        <a href="C:\Users\user\Downloads\Business-owner\web\Support.html"
                            class="sidebar-link flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-button">
                            <div class="w-5 h-5 flex items-center justify-center mr-3">
                                <i class="ri-lifebuoy-line"></i>
                            </div>
                            Support
                        </a>
                    </li>


                </ul>
            </nav>




            <div class="p-4 border-t">
                <button id="collapse-sidebar"
                    class="flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-button hover:bg-gray-200 transition-colors whitespace-nowrap">
                    <div class="w-5 h-5 flex items-center justify-center mr-2">
                        <i class="ri-arrow-left-line"></i>
                    </div>
                    Collapse Sidebar
                </button>
            </div>
        </aside>
        <script id="sidebar-toggle-script">
            document.addEventListener('DOMContentLoaded', function () {
                const sidebar = document.getElementById('sidebar');
                const collapseBtn = document.getElementById('collapse-sidebar');
                const expandBtn = document.getElementById('expand-sidebar');
                // Add submenu toggle functionality
                const sidebarButtons = document.querySelectorAll('button.sidebar-link');
                sidebarButtons.forEach(button => {
                    const submenu = button.nextElementSibling;
                    button.addEventListener('click', function (e) {
                        e.preventDefault();
                        submenu.classList.toggle('hidden');
                        button.setAttribute('data-expanded', submenu.classList.contains('hidden') ? 'false' : 'true');
                        // Find and rotate the arrow icon
                        const arrowIcon = button.querySelector('.group-data-\\[expanded\\=true\\]\\:rotate-180');
                        if (submenu.classList.contains('hidden')) {
                            arrowIcon.style.transform = 'rotate(0deg)';
                        } else {
                            arrowIcon.style.transform = 'rotate(180deg)';
                        }
                    });
                });
                collapseBtn.addEventListener('click', function () {
                    sidebar.classList.add('w-20');
                    sidebar.classList.remove('w-64');
                    // Hide text and show only icons
                    document.querySelectorAll('.sidebar-link span').forEach(el => {
                        el.classList.add('hidden');
                    });
                    collapseBtn.classList.add('hidden');
                    expandBtn.classList.remove('hidden');
                });
                expandBtn.addEventListener('click', function () {
                    sidebar.classList.remove('w-20');
                    sidebar.classList.add('w-64');
                    // Show text again
                    document.querySelectorAll('.sidebar-link span').forEach(el => {
                        el.classList.remove('hidden');
                    });
                    collapseBtn.classList.remove('hidden');
                    expandBtn.classList.add('hidden');
                });
            });
        </script>
        <script id="profile-dropdown-script">
            document.addEventListener('DOMContentLoaded', function () {
                const profileMenuButton = document.getElementById('profile-menu-button');
                const profileDropdown = document.getElementById('profile-dropdown');
                profileMenuButton.addEventListener('click', function () {
                    profileDropdown.classList.toggle('hidden');
                });
                // Close dropdown when clicking outside
                document.addEventListener('click', function (event) {
                    if (!profileMenuButton.contains(event.target) && !profileDropdown.contains(event.target)) {
                        profileDropdown.classList.add('hidden');
                    }
                });
            });
        </script>


        <header class="fixed top-0 left-64 right-0 bg-white shadow-sm z-40">
            <div class="flex items-center justify-between px-6 py-4">
                <!-- <div> -->
                <!-- Search here -->
                <!-- <div class="flex items-center flex-1">
                    <button id="expand-sidebar"
                        class="hidden mr-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="ri-menu-line ri-lg"></i>
                    </button>
                    <div class="relative max-w-md w-full">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <div class="w-5 h-5 flex items-center justify-center text-gray-400">
                                <i class="ri-search-line"></i>
                            </div>
                        </div>
                        <input type="search"
                            class="block w-full pl-10 pr-4 py-2 border-none rounded-button bg-gray-100 focus:bg-white focus:ring-2 focus:ring-primary focus:ring-opacity-20 text-sm"
                            placeholder="Search Dashboard ...">
                    </div>
                </div> -->
                <div class="flex">
                    <h1 class="text-3xl font-bold text-gray-900">Messages</h1>
                    <button id=" startNewConversationBtn"
                        class="ctaz bg-blue-600 text-white px-4 py-2 rounded-lg font-normal hover:bg-blue-700 transition-colors flex items-center gap-2 !rounded-button whitespace-nowrap ml-24" style="font-size: small; font-weight: 400;">
                        <div class="w-4 h-4 flex items-center justify-center">
                            <i class="ri-chat-1-line"></i>
                        </div>
                        Start New Conversation
                    </button>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600 hidden md:block">
                        July 2, 2025 â€¢ Wednesday
                    </div>
                    <div class="relative">
                        <button
                            class="w-10 h-10 flex items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 focus:outline-none">
                            <div class="w-6 h-6 flex items-center justify-center relative">
                                <i class="ri-notification-3-line"></i>
                                <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                            </div>
                        </button>
                    </div>
                    <div class="relative">
                        <button id="profile-menu-button" class="flex items-center space-x-2 focus:outline-none">

                            <div class="w-10 h-10 bg-primary rounded-full overflow-hidden">
                                <img src="https://readdy.ai/api/search-image?query=professional%20business%20headshot%20of%20John%20Smith%2C%20male%20executive%2C%20confident%20smile%2C%20business%20attire%2C%20clean%20background&width=80&height=80&seq=1&orientation=squarish"
                                    alt="John Smith" class="w-full h-full object-cover">
                            </div>
                            <div class="hidden md:block text-left">
                                <!-- <div class="text-sm font-medium">Emma Thompson</div> -->
                                <span class="text-sm font-medium text-gray-900">John Smith</span>

                                <div class="text-xs text-gray-500">Admin</div>
                            </div>
                            <div class="w-5 h-5 flex items-center justify-center text-gray-500">
                                <i class="ri-arrow-down-s-line"></i>
                            </div>
                        </button>
                        <div id="profile-dropdown"
                            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-20">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Your
                                Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</a>
                        </div>
                    </div>
                </div>

            </div>
        </header>


        <main class="flex-1 p-4 md:p-8 mt-16 overflow-y-auto">
            <!-- <header class="mb-8 flex justify-between items-start">
                 <div>
                    <h1 class="text-3xl font-bold text-gray-900">Messages</h1>
                    <p class="text-gray-600 mt-2">Communicate directly with your customers and the Platform support
                        team.</p>
                </div> 
                <button id="startNewConversationBtn"
                    class="ctaz bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 !rounded-button whitespace-nowrap">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <i class="ri-chat-1-line"></i>
                    </div>
                    Start New Conversation
                </button>
            </header> -->

            <!-- <div class="flex flex-col md:flex-row bg-white rounded-lg shadow-md h-[calc(100vh-200px)]"> -->
            <div class="flex flex-col md:flex-row bg-white rounded-lg shadow-md ">

                <!-- <div id="conversationListPane"
                    class="conversation-list-pane border-r border-gray-200 p-4 overflow-y-auto"> -->
                    <div id="conversationListPane"
                    class="conversation-list-pane border-r border-gray-200 p-4">

                <!-- <div class="flex flex-col gap-2">
                    <button id=" startNewConversationBtn" class="ctaz bg-blue-600 text-white px-4 py-2 rounded-lg font-normal hover:bg-blue-700 transition-colors flex items-center gap-2 !rounded-button whitespace-nowrap m-2" style="font-size: small; font-weight: 400;">
                        <div class="w-4 h-4 flex items-center justify-center">
                            <i class="ri-chat-1-line"></i>
                        </div>
                        Start New Conversation
                    </button> -->

                    <div class="relative mb-1">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <div class="w-4 h-4 flex items-center justify-center text-gray-400">
                                <i class="ri-search-line"></i>
                            </div>
                        </div>
                        <input type="text" id="conversationSearch"
                            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                            placeholder="Search conversations...">
                    </div>
                    <!-- </div> -->
                    <div id="conversationsContainer" class="space-y-2"></div>
                </div>
                

                <div id="conversationDetailPane" class="message-detail-pane p-4">
                    <div id="detailHeader" class="border-b border-gray-200 pb-4 mb-4 flex items-center justify-between">
                        <div class="flex items-center">
                            <button id="backToListBtn" class="md:hidden mr-3 p-2 text-gray-600 hover:text-gray-800">
                                <div class="w-5 h-5 flex items-center justify-center">
                                    <i class="ri-arrow-left-line"></i>
                                </div>
                            </button>
                            <img id="recipientAvatar" src="https://placehold.co/40x40/e2e8f0/8b5cf6?text=U" alt="Avatar"
                                class="w-10 h-10 rounded-full mr-3 object-cover">
                            <div>
                                <span id="recipientName" class="font-semibold text-gray-900">Select a
                                    conversation</span>
                                <div id="recipientStatus" class="text-sm text-gray-500">Online</div>
                            </div>
                        </div>
                        <button id="conversationOptionsBtn" class="p-2 text-gray-600 hover:text-gray-800">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-more-2-line"></i>
                            </div>
                        </button>
                    </div>

                    <div id="messageHistory" class="message-history flex flex-col">
                        <div class="flex items-center justify-center h-full text-gray-500">
                            <div class="text-center">
                                <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4 text-gray-300">
                                    <i class="ri-message-3-line text-4xl"></i>
                                </div>
                                <p>Select a conversation to start messaging</p>
                            </div>
                        </div>
                    </div>

                    <div id="messageInputArea" class="mt-4 pt-4 border-t border-gray-200">
                        <div id="messageAttachmentPreviews" class="mb-2"></div>
                        <div class="flex items-end gap-3">
                            <input type="file" id="messageAttachmentUpload" multiple class="hidden">
                            <button id="attachmentBtn" class="p-2 text-gray-600 hover:text-gray-800 flex-shrink-0">
                                <div class="w-5 h-5 flex items-center justify-center">
                                    <i class="ri-attachment-line"></i>
                                </div>
                            </button>
                            <div class="flex-1 relative">
                                <textarea id="messageInput" rows="1" placeholder="Type your message..."
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"></textarea>
                            </div>
                            <button id="sendBtn"
                                class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition-colors flex-shrink-0">
                                <div class="w-5 h-5 flex items-center justify-center">
                                    <i class="ri-send-plane-fill"></i>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="newConversationModal" class="modal-overlay">
        <div class="modal-content max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-900">Start New Conversation</h3>
                <button id="closeNewConversationModal" class="text-gray-400 hover:text-gray-600">
                    <div class="w-6 h-6 flex items-center justify-center">
                        <i class="ri-close-line text-xl"></i>
                    </div>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Recipient</label>
                    <input type="text" id="newConversationRecipient"
                        class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                        placeholder="Customer name or email">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                    <textarea id="newConversationMessage" rows="4"
                        class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                        placeholder="Type your message..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button id="cancelNewConversationBtn"
                    class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors !rounded-button whitespace-nowrap">Cancel</button>
                <button id="startChatBtn"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors !rounded-button whitespace-nowrap">Start
                    Chat</button>
            </div>
        </div>
    </div>

    <script id="mockData">
        const conversations = [
            {
                id: 'conv_001',
                recipientName: 'Sarah Johnson',
                recipientType: 'customer',
                avatarUrl: 'https://placehold.co/40x40/e2e8f0/8b5cf6?text=SJ',
                lastMessageSnippet: 'Thank you for the quick response! Looking forward to the tour.',
                lastMessageTimestamp: '2024-07-30 14:30',
                unread: true,
                online: true
            },
            {
                id: 'conv_002',
                recipientName: 'Michael Chen',
                recipientType: 'customer',
                avatarUrl: 'https://placehold.co/40x40/e2e8f0/8b5cf6?text=MC',
                lastMessageSnippet: 'Could you please confirm the meeting point for tomorrow?',
                lastMessageTimestamp: '2024-07-30 13:15',
                unread: false,
                online: false
            },
            {
                id: 'conv_003',
                recipientName: 'Platform Support',
                recipientType: 'admin',
                avatarUrl: 'https://placehold.co/40x40/3b82f6/ffffff?text=PS',
                lastMessageSnippet: 'Your listing has been approved and is now live.',
                lastMessageTimestamp: '2024-07-30 11:45',
                unread: true,
                online: true
            },
            {
                id: 'conv_004',
                recipientName: 'Emma Rodriguez',
                recipientType: 'customer',
                avatarUrl: 'https://placehold.co/40x40/e2e8f0/8b5cf6?text=ER',
                lastMessageSnippet: 'The desert safari was absolutely amazing! Thank you so much.',
                lastMessageTimestamp: '2024-07-30 10:20',
                unread: false,
                online: true
            },
            {
                id: 'conv_005',
                recipientName: 'David Thompson',
                recipientType: 'customer',
                avatarUrl: 'https://placehold.co/40x40/e2e8f0/8b5cf6?text=DT',
                lastMessageSnippet: 'Is it possible to reschedule our booking to next week?',
                lastMessageTimestamp: '2024-07-30 09:30',
                unread: true,
                online: false
            },
            {
                id: 'conv_006',
                recipientName: 'Lisa Wang',
                recipientType: 'customer',
                avatarUrl: 'https://placehold.co/40x40/e2e8f0/8b5cf6?text=LW',
                lastMessageSnippet: 'Perfect! See you at 9 AM tomorrow.',
                lastMessageTimestamp: '2024-07-29 16:45',
                unread: false,
                online: false
            }
        ];

        const messages = {
            'conv_001': [
                {
                    sender: 'Sarah Johnson',
                    timestamp: '2024-07-30 14:15',
                    content: 'Hi! I\'m interested in booking the Doha City Tour for 4 people on August 15th. Could you please provide availability and pricing details?',
                    attachments: []
                },
                {
                    sender: 'You',
                    timestamp: '2024-07-30 14:20',
                    content: 'Hello Sarah! Thank you for your interest. Yes, we have availability for August 15th. The tour is $75 per person for groups of 4+. I\'ll send you the detailed itinerary.',
                    attachments: []
                },
                {
                    sender: 'Sarah Johnson',
                    timestamp: '2024-07-30 14:30',
                    content: 'Thank you for the quick response! Looking forward to the tour.',
                    attachments: []
                }
            ],
            'conv_002': [
                {
                    sender: 'Michael Chen',
                    timestamp: '2024-07-30 13:00',
                    content: 'Hello, I have a booking for the Museum tour tomorrow at 10 AM.',
                    attachments: []
                },
                {
                    sender: 'You',
                    timestamp: '2024-07-30 13:10',
                    content: 'Hi Michael! Yes, I have your booking confirmed. The meeting point is at the main entrance of the Museum of Islamic Art.',
                    attachments: []
                },
                {
                    sender: 'Michael Chen',
                    timestamp: '2024-07-30 13:15',
                    content: 'Could you please confirm the meeting point for tomorrow?',
                    attachments: []
                }
            ],
            'conv_003': [
                {
                    sender: 'Platform Support',
                    timestamp: '2024-07-30 11:30',
                    content: 'Hello! We\'ve reviewed your recent listing submission for "Pearl Diving Experience".',
                    attachments: []
                },
                {
                    sender: 'Platform Support',
                    timestamp: '2024-07-30 11:45',
                    content: 'Your listing has been approved and is now live.',
                    attachments: []
                }
            ],
            'conv_004': [
                {
                    sender: 'Emma Rodriguez',
                    timestamp: '2024-07-30 10:05',
                    content: 'Just wanted to say thank you for yesterday\'s desert safari experience!',
                    attachments: []
                },
                {
                    sender: 'You',
                    timestamp: '2024-07-30 10:15',
                    content: 'Thank you so much Emma! I\'m thrilled you enjoyed it. Your feedback means a lot to us.',
                    attachments: []
                },
                {
                    sender: 'Emma Rodriguez',
                    timestamp: '2024-07-30 10:20',
                    content: 'The desert safari was absolutely amazing! Thank you so much.',
                    attachments: []
                }
            ],
            'conv_005': [
                {
                    sender: 'David Thompson',
                    timestamp: '2024-07-30 09:30',
                    content: 'Is it possible to reschedule our booking to next week?',
                    attachments: []
                }
            ],
            'conv_006': [
                {
                    sender: 'Lisa Wang',
                    timestamp: '2024-07-29 16:30',
                    content: 'Looking forward to the Souq Waqif tour tomorrow!',
                    attachments: []
                },
                {
                    sender: 'You',
                    timestamp: '2024-07-29 16:40',
                    content: 'Great! Meet us at the main entrance at 9 AM. I\'ll be wearing a blue Platform guide shirt.',
                    attachments: []
                },
                {
                    sender: 'Lisa Wang',
                    timestamp: '2024-07-29 16:45',
                    content: 'Perfect! See you at 9 AM tomorrow.',
                    attachments: []
                }
            ]
        };
    </script>

    <script id="conversationManagement">
        document.addEventListener('DOMContentLoaded', function () {
            const conversationSearch = document.getElementById('conversationSearch');
            const conversationsContainer = document.getElementById('conversationsContainer');
            const conversationDetailPane = document.getElementById('conversationDetailPane');
            const conversationListPane = document.getElementById('conversationListPane');
            const detailHeader = document.getElementById('detailHeader');
            const recipientAvatar = document.getElementById('recipientAvatar');
            const recipientName = document.getElementById('recipientName');
            const recipientStatus = document.getElementById('recipientStatus');
            const messageHistory = document.getElementById('messageHistory');
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const attachmentBtn = document.getElementById('attachmentBtn');
            const messageAttachmentUpload = document.getElementById('messageAttachmentUpload');
            const messageAttachmentPreviews = document.getElementById('messageAttachmentPreviews');
            const backToListBtn = document.getElementById('backToListBtn');

            let activeConversationId = null;
            let selectedAttachments = [];
            function formatTimestamp(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diffInHours = (now - date) / (1000 * 60 * 60);

                if (diffInHours < 1) {
                    const diffInMinutes = Math.floor((now - date) / (1000 * 60));
                    return diffInMinutes <= 1 ? 'now' : `${diffInMinutes}m ago`;
                } else if (diffInHours < 24) {
                    return `${Math.floor(diffInHours)}h ago`;
                } else {
                    return date.toLocaleDateString();
                }
            }

            function renderConversationList() {
                const searchTerm = conversationSearch.value.toLowerCase();
                const filteredConversations = conversations.filter(conv =>
                    conv.recipientName.toLowerCase().includes(searchTerm) ||
                    conv.lastMessageSnippet.toLowerCase().includes(searchTerm)
                );

                const sortedConversations = filteredConversations.sort((a, b) =>
                    new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp)
                );

                conversationsContainer.innerHTML = '';

                sortedConversations.forEach(conversation => {
                    const conversationItem = document.createElement('div');
                    conversationItem.className = `conversation-item flex items-center p-3 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors ${activeConversationId === conversation.id ? 'active' : ''}`;
                    conversationItem.dataset.id = conversation.id;

                    conversationItem.innerHTML = `
                        <div class="relative">
                            <img src="${conversation.avatarUrl}" alt="Avatar" class="w-10 h-10 rounded-full mr-3 object-cover">
                            ${conversation.online ? '<span class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-semibold text-gray-900 truncate">${conversation.recipientName}</span>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-2">${formatTimestamp(conversation.lastMessageTimestamp)}</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate">${conversation.lastMessageSnippet}</p>
                        </div>
                        ${conversation.unread ? '<span class="w-2 h-2 bg-blue-500 rounded-full ml-2 flex-shrink-0"></span>' : ''}
                    `;

                    conversationItem.addEventListener('click', () => loadConversationDetail(conversation.id));
                    conversationsContainer.appendChild(conversationItem);
                });
            }

            function loadConversationDetail(conversationId) {
                const conversation = conversations.find(c => c.id === conversationId);
                if (!conversation) return;
                activeConversationId = conversationId;

                recipientAvatar.src = conversation.avatarUrl;
                recipientName.textContent = conversation.recipientName;
                recipientStatus.textContent = conversation.online ? 'Online' : 'Last seen recently';
                recipientStatus.className = `text-sm ${conversation.online ? 'text-green-600' : 'text-gray-500'}`;

                conversation.unread = false;
                renderConversationList();

                const conversationMessages = messages[conversationId] || [];
                messageHistory.innerHTML = '';
                conversationMessages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    const isSender = message.sender === 'You';

                    messageDiv.className = `message-bubble ${isSender ? 'sender' : 'recipient'}`;
                    messageDiv.innerHTML = `
                        <p>${message.content}</p>
                        ${message.attachments && message.attachments.length > 0 ?
                            `<div class="mt-2">${message.attachments.map(att => `<span class="attachment-preview-item"><i class="ri-file-line mr-1"></i>${att}</span>`).join('')}</div>` :
                            ''
                        }
                        <span class="text-xs ${isSender ? 'opacity-80' : 'text-gray-600'} mt-1 block ${isSender ? 'text-right' : ''}">${formatTimestamp(message.timestamp)}</span>
                    `;

                    messageHistory.appendChild(messageDiv);
                });

                messageHistory.scrollTop = messageHistory.scrollHeight;
                if (window.innerWidth < 768) {
                    conversationListPane.classList.add('hidden');
                    conversationDetailPane.classList.add('active');
                }
            }

            function sendMessage() {
                const content = messageInput.value.trim();
                if (!content && selectedAttachments.length === 0) return;
                if (!activeConversationId) return;

                const newMessage = {
                    sender: 'You',
                    timestamp: new Date().toISOString(),
                    content: content,
                    attachments: [...selectedAttachments]
                };

                if (!messages[activeConversationId]) {
                    messages[activeConversationId] = [];
                }
                messages[activeConversationId].push(newMessage);
                const conversation = conversations.find(c => c.id === activeConversationId);
                if (conversation) {
                    conversation.lastMessageSnippet = content || `Sent ${selectedAttachments.length} file(s)`;
                    conversation.lastMessageTimestamp = newMessage.timestamp;
                }

                messageInput.value = '';
                selectedAttachments = [];
                messageAttachmentPreviews.innerHTML = '';

                loadConversationDetail(activeConversationId);
                renderConversationList();

                setTimeout(() => {
                    if (Math.random() > 0.7) {
                        showTypingIndicator();
                        setTimeout(() => {
                            hideTypingIndicator();
                            simulateReply();
                        }, 2000);
                    }
                }, 1000);
            }

            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = `
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span class="ml-2 text-sm text-gray-600">typing...</span>
                `;
                messageHistory.appendChild(typingDiv);
                messageHistory.scrollTop = messageHistory.scrollHeight;
            }

            function hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            function simulateReply() {
                const replies = [
                    "Thank you for your message! I'll get back to you shortly.",
                    "Got it, thanks for letting me know.",
                    "Perfect! Looking forward to it.",
                    "Thanks for the update.",
                    "Understood, I'll take care of that."
                ];

                const conversation = conversations.find(c => c.id === activeConversationId);
                if (!conversation) return;
                const replyMessage = {
                    sender: conversation.recipientName,
                    timestamp: new Date().toISOString(),
                    content: replies[Math.floor(Math.random() * replies.length)],
                    attachments: []
                };
                messages[activeConversationId].push(replyMessage);
                conversation.lastMessageSnippet = replyMessage.content;
                conversation.lastMessageTimestamp = replyMessage.timestamp;
                conversation.unread = true;

                loadConversationDetail(activeConversationId);
                renderConversationList();
            }

            function handleAttachmentSelection(event) {
                const files = Array.from(event.target.files);
                selectedAttachments = files.map(file => file.name);

                messageAttachmentPreviews.innerHTML = '';
                selectedAttachments.forEach(fileName => {
                    const preview = document.createElement('span');
                    preview.className = 'attachment-preview-item';
                    preview.innerHTML = `
                        <i class="ri-file-line mr-1"></i>
                        ${fileName}
                        <button class="ml-2 text-red-500 hover:text-red-700" onclick="this.parentElement.remove()">
                            <i class="ri-close-line"></i>
                        </button>
                    `;
                    messageAttachmentPreviews.appendChild(preview);
                });
            }

            function autoResizeTextarea() {
                messageInput.style.height = 'auto';
                messageInput.style.height = Math.min(messageInput.scrollHeight, 120) + 'px';
            }

            conversationSearch.addEventListener('input', renderConversationList);

            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            messageInput.addEventListener('input', autoResizeTextarea);

            sendBtn.addEventListener('click', sendMessage);
            attachmentBtn.addEventListener('click', () => {
                messageAttachmentUpload.click();
            });

            messageAttachmentUpload.addEventListener('change', handleAttachmentSelection);
            backToListBtn.addEventListener('click', () => {
                conversationListPane.classList.remove('hidden');
                conversationDetailPane.classList.remove('active');
            });

            renderConversationList();
            if (conversations.length > 0) {
                loadConversationDetail(conversations[0].id);
            }
        });
    </script>

    <script id="newConversationModal">
        document.addEventListener('DOMContentLoaded', function () {
            const startNewConversationBtn = document.getElementById('startNewConversationBtn');
            const newConversationModal = document.getElementById('newConversationModal');
            const closeNewConversationModal = document.getElementById('closeNewConversationModal');
            const cancelNewConversationBtn = document.getElementById('cancelNewConversationBtn');
            const startChatBtn = document.getElementById('startChatBtn');
            const newConversationRecipient = document.getElementById('newConversationRecipient');
            const newConversationMessage = document.getElementById('newConversationMessage');

            function openNewConversationModal() {
                newConversationModal.classList.add('active');
                newConversationRecipient.focus();
            }

            function closeModal() {
                newConversationModal.classList.remove('active');
                newConversationRecipient.value = '';
                newConversationMessage.value = '';
            }

            function startNewConversation() {
                const recipient = newConversationRecipient.value.trim();
                const message = newConversationMessage.value.trim();

                if (!recipient || !message) {
                    alert('Please fill in both recipient and message fields.');
                    return;
                }

                const newConversationId = 'conv_' + Date.now();
                const newConversation = {
                    id: newConversationId,
                    recipientName: recipient,
                    recipientType: 'customer',
                    avatarUrl: `https://placehold.co/40x40/e2e8f0/8b5cf6?text=${recipient.charAt(0).toUpperCase()}`,
                    lastMessageSnippet: message,
                    lastMessageTimestamp: new Date().toISOString(),
                    unread: false,
                    online: Math.random() > 0.5
                };

                conversations.unshift(newConversation);
                messages[newConversationId] = [{
                    sender: 'You',
                    timestamp: new Date().toISOString(),
                    content: message,
                    attachments: []
                }];

                closeModal();

                const event = new CustomEvent('conversationListUpdated');
                document.dispatchEvent(event);

                const loadEvent = new CustomEvent('loadConversation', { detail: { id: newConversationId } });
                document.dispatchEvent(loadEvent);
            }

            startNewConversationBtn.addEventListener('click', openNewConversationModal);
            closeNewConversationModal.addEventListener('click', closeModal);
            cancelNewConversationBtn.addEventListener('click', closeModal);
            startChatBtn.addEventListener('click', startNewConversation);

            newConversationModal.addEventListener('click', (e) => {
                if (e.target === newConversationModal) {
                    closeModal();
                }
            });

            document.addEventListener('conversationListUpdated', () => {
                const renderEvent = new Event('renderConversations');
                document.dispatchEvent(renderEvent);
            });
            document.addEventListener('loadConversation', (e) => {
                const loadDetailEvent = new CustomEvent('loadConversationDetail', { detail: e.detail });
                document.dispatchEvent(loadDetailEvent);
            });
        });
    </script>
</body>

</html>